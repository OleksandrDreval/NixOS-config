**Конфігурація безпеки NixOS (v24.11)**
Конфігурація використовує підхід "defense in depth" з кількома шарами захисту, що робить її придатною для роботи з конфіденційними даними або в небезпечних мережевих середовищах. Конфігурація реалізує принцип "найменших привілеїв" та "захисту в глибину", що робить її придатною для роботи з конфіденційними даними.

**1. Захист завантажувального середовища**  
- Шифрування диска LUKS з systemd-initrd (рядок 28)  
- Відключення EFI-змін (рядок 22)  
- Обмеження кількості конфігурацій завантажувача до 5 (рядок 16)  

**2. Параметри ядра Linux**  
- Використання останньої стабільної версії ядра (рядок 32)  
- Захист від Spectre/Meltdown через параметри:  
  ```nix
  "l1tf=full,force" 
  "mds=full,nosmt" 
  "spectre_v2=on"
  ```  
- Примусове підписування модулів ядра (рядок 47)  
- Використання KPTI (рядок 50) та SMAP/SMEP (рядок 297)

**3. Мережева безпека**  
- Строгий фаєрвол з:  
  - Блокуванням ICMP-пінгів (рядки 121-122)  
  - Фільтрацією TCP-флагів (рядки 124-139)  
  - Обмеженням портів до мінімально необхідних (рядки 99-115)  
- Використання DNS-over-TLS (рядок 87)  
- Відключення IPv6-тимчасових адрес (рядок 86)

**4. Системне журналювання**  
- Налаштування systemd-journald з:  
  - Шифруванням логів (рядок 183)  
  - Обмеженням розміру журналів (рядок 180)  
  - Аудит-трейсами (рядок 184)  

**5. Обмеження користувачів**  
- Використання SELinux у режимі enforcement (рядки 314-315)  
- Жорсткі обмеження PAM (рядки 307-310)  
- Відключення мультипотоковості (рядок 298)  
- Захист sudo через:  
  ```nix
  execWheelOnly = true
  use_pty
  ```

**6. Віртуалізація з підвищеною безпекою**  
- Libvirt з SELinux-профілями (рядок 377)  
- Seccomp-фільтри (рядок 387)  
- Обмежений доступ до пристроїв (рядки 382-386)  
- Використання QEMU/KVM (рядок 372)

**7. Додаткові практики**  
- Nix sandbox для пакетів (рядок 327)  
- Автоматична оптимізація сховища (рядок 328)  
- Відключення непотрібних сервісів (SSH у рядку 196)  
- Використання Secure Boot інструментів (sbctl у рядку 351)

**Моніторинг та візуалізація**  
- Auditd для відстеження:  
  - Виконання процесів (рядок 286)  
  - Мережевих з'єднань (рядки 287-288)  
- Візуалізація мережі через virt-manager (рядок 354)  
- Інструменти аналізу: pciutils, kmod (рядки 353, 357)
